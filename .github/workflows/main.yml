name: Build

on:
    push:
        branches:
          - main
jobs:
    release:
        name: build and release electron app
        # 流水线会跑在哪些操作系统中
        runs-on: ${{ matrix.os }}  
        strategy:
            fail-fast: false
            matrix:
              # 流水线将分别触发在 windows系统中
              os: [windows-latest]  
        steps:
          - name: Check out
            uses: actions/checkout@v3.0.0
            # 安装node
          - name: Install Node.js
            uses: actions/setup-node@v3.0.0
            with:
              node-version: "16"
            # 安装依赖
          - name: Install
            run: yarn install
            
          - name: Build Electron App
            run: yarn build:win:publish
            env:
              GITHUB_TOKEN: ${{ secrets.ACCESS_TOKEN }}

          - name: Cleanup Artifacts for Windows
            if: matrix.os == 'windows-latest'
            run: |
              npx rimraf "dist/!(*.exe)"

          - name: upload artifacts
            uses: actions/upload-artifact@v3.0.0
            with:
              name: ${{ matrix.os }}
              path: dist

          - name: release
            uses: softprops/action-gh-release@v0.1.14
            if: startsWith(github.ref, 'refs/tags/')
            with:
              files: "dist/**"
            env:
              GITHUB_TOKEN: ${{ secrets.ACCESS_TOKEN }}
